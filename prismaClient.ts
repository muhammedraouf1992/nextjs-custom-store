// import { PrismaClient } from "@prisma/client";

// const globalForPrisma = globalThis;

// const prismaBase = globalForPrisma.prisma ?? new PrismaClient();

// export const prisma = prismaBase.$extends({
//   query: {
//     cart: {
//       async update({ args, query }) {
//         args.data = { ...args.data, updatedAt: new Date() };
//         return query(args);
//       },
//     },
//   },
// });

// if (process.env.NODE_ENV !== "production") globalForPrisma.prisma = prismaBase;

import { PrismaClient } from "@prisma/client";

const prismaClientSingleton = () => {
  return new PrismaClient();
};

declare const globalThis: {
  prismaGlobal: ReturnType<typeof prismaClientSingleton>;
} & typeof global;

const prisma = globalThis.prismaGlobal ?? prismaClientSingleton();

export default prisma;

if (process.env.NODE_ENV !== "production") globalThis.prismaGlobal = prisma;
